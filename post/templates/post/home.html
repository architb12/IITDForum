{% extends "post/base.html" %}
{% block content %}
    <div class="write-post">
        {{Element.className}}
        <font class="write-post-font">
            <b>What's on your mind?</b>
        </font>
        <br>
        
    </div>
    {% for post in posts %}
    <div class="home-post">
        <font class="username-font">
            <b>{{post.author.username}}</b>
        </font>
        <br>
        <font class="name-font">
            {{post.author.profile.full_name}}
        </font>
        <hr class="hr1" align="left">
        <font class="post-content-font">
            {{post.text}}
        </font>
        <br>
        <div class="like-wrapper">
            {% if request.user in post.postlike.likers.all %}
                <div class="like-button-wrapper">
                    <i class="fa fa-heart liked like-button" aria-hidden="true" id="like{{ post.id }}" data-catid="{{ post.id }}"></i>
                </div>
                <div class="likes-count" id="likes-count{{ post.id }}" data-catid="{{post.postlike.likers.count}}">
                    <font class="like-count-font">
                        
                        {% if post.postlike.likers.count == 1 %}
                            You liked this post.
                        {% elif post.postlike.likers.count == 2 %}
                            You and one other liked this post.
                        {% else %} 
                            You and {{ post.postlike.likers.count|add:"-1" }} others liked this post.
                        {% endif %}
                    
                    </font>
                </div>
                
            {% else %}
                <div class="like-button-wrapper"> 
                    <i class="fa fa-heart-o likes like-button" aria-hidden="true" id="like{{ post.id }}" data-catid="{{ post.id }}"></i>
                </div>
                <div class="likes-count" id="likes-count{{ post.id }}" data-catid="{{post.postlike.likers.count}}">
                    <font class="like-count-font">
                        {% if post.postlike.likers.count == 0 %}
                            No likes yet.
                        {% elif post.postlike.likers.count == 1 %}
                            One person liked this post.
                        {% else %} 
                            {{ post.postlike.likers.count }} people liked this post.
                        {% endif %}
                    </font>
                </div>
            {% endif %}
        </div>
        
    </div>
    {% endfor %}
    <script type="text/javascript"> 
        $('.like-button').click(function(){ 
            var id; 
            id = $(this).attr("data-catid"); 
            $.ajax( 
            { 
                type:"GET", 
                url: "{% url 'post:post_like' %}", 
                data:{ 
                        post_id: id 
                }, 
                success: function( data ) 
                {
                    var likes = parseInt($('#likes-count'+id).attr("data-catid"))
                    if ($('#like' + id).hasClass('fa-heart-o')){
                        $( '#like' + id ).removeClass('fa-heart-o likes'); 
                        $( '#like' + id ).addClass('fa-heart liked'); 

                        var Div = document.getElementById("likes-count"+id);

                        if(likes==0){
                            Div.textContent = "You liked this post.";
                        }
                        else if(likes==1){
                            Div.textContent = "You and one other liked this post.";
                        }
                        else{
                            Div.textContent = "You and "+ (likes).toString() + " others liked this post.";
                        }

                        $('#likes-count'+id).attr("data-catid",(likes+1).toString())
                    }
                    else{
                        $( '#like' + id ).removeClass('fa-heart liked'); 
                        $( '#like' + id ).addClass('fa-heart-o likes'); 
                        
                        var Div = document.getElementById("likes-count"+id);

                        if(likes==1){
                            Div.textContent = "No likes yet.";
                        }
                        else if(likes==2){
                            Div.textContent = "One person liked this post.";
                        }
                        else{
                            Div.textContent = (likes-1).toString() + " people liked this post."
                        }

                        $('#likes-count'+id).attr("data-catid",(likes-1).toString())
                        
                    }
                }
            }) 
        });
    </script>        
{% endblock content %}
